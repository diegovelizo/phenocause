% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/wrappers.R
\name{sample_causal_sites.collider}
\alias{sample_causal_sites.collider}
\title{Sample causal genetic variants (collider mode)}
\usage{
sample_causal_sites.collider(
  gds_paths,
  n_causal_sites,
  pca_matrix,
  collider_r2_candidate_threshold = 0.975,
  collider_r2_control_threshold = 0.025,
  missingness_threshold = NULL,
  mac_threshold = NULL,
  n_threads = 1
)
}
\arguments{
\item{gds_paths}{A character vector of paths to the GDS files. When \code{length > 1}, each file is expected to contain data for a single chromosome.}

\item{n_causal_sites}{A single positive integer specifying the total number of causal sites to sample for \emph{each} set (structured and non-structured).}

\item{pca_matrix}{A data frame or matrix containing principal components for all samples. The first column must be named \code{sample.id} (case-insensitive), and all subsequent columns must contain the PC scores (e.g., \code{PC1}, \code{PC2}, ...). Providing this argument activates the \code{collider} sampling mode.}

\item{collider_r2_candidate_threshold}{A numeric quantile between 0 and 1. Variants with an R^2 value above this quantile within their MAF stratum are placed in the "structured" set. Default is \code{0.975}.}

\item{collider_r2_control_threshold}{A numeric quantile between 0 and 1. Variants with an R^2 value below this quantile are placed in the "non-structured" set. Default is \code{0.025}.}

\item{missingness_threshold}{A numeric value between 0 and 1. Variants with a missingness rate greater than this threshold will be excluded before sampling. Default is \code{NULL}.}

\item{mac_threshold}{A positive integer. Variants with a minor allele count (MAC) less than this threshold will be excluded before sampling. Default is \code{NULL}.}

\item{n_threads}{A positive integer specifying the number of threads for parallel operations on GDS files. Default is 1.}
}
\value{
A nested list containing the annotations and genotypes for the structured and non-structured variant sets.
\describe{
\item{\code{annotations}}{A list of four data frames:
\itemize{
\item \code{causal_structured}: Annotations for the \code{n_causal_sites} variants sampled from the high-R^2 set.
\item \code{causal_non_structured}: Annotations for the \code{n_causal_sites} variants sampled from the low-R^2 set.
\item \code{non_causal_structured}: Annotations for the remaining high-R^2 variants not chosen as causal.
\item \code{non_causal_non_structured}: Annotations for the remaining low-R^2 variants not chosen as causal.
}
}
\item{\code{genotypes}}{A list of two data frames, providing the genotype matrices for both causal sets:
\itemize{
\item \code{causal_structured}: Genotypes for the \code{n_causal_sites} variants from the high-R^2 set.
\item \code{causal_non_structured}: Genotypes for the \code{n_causal_sites} variants from the low-R^2 set.
}
}
}
}
\description{
Samples causal variants from a set of GDS files based on their correlation with principal components (PCs). This function is a wrapper for the \code{collider} mode of \code{sample_causal_sites()}. It is designed to generate sets of variants that can be used to study and benchmark methods for handling collider bias in genome-wide association studies.
}
\details{
This function triggers the \code{collider} sampling mode. It first calculates the squared multiple correlation (R^2) between each variant and the provided principal components. It then stratifies variants by minor allele frequency (MAF) and samples two parallel sets of causal variants:
\itemize{
\item A \strong{"structured" set} from variants with high R^2 values. Phenotypes generated using this set are expected to be susceptible to collider bias when PCs are included as covariates in a GWAS model.
\item A \strong{"non-structured" set} from variants with low R^2 values. This set serves as a negative control, as phenotypes generated from it should not be subject to the same bias.
}
}
\examples{
\dontrun{
# Ensure required packages and package data are available for the examples
if (!requireNamespace("data.table", quietly = TRUE) ||
    !requireNamespace("SeqArray", quietly = TRUE)) {
  stop("Please install data.table and SeqArray to run these examples.")
}

##================================================================
## Example: Collider mode sampling
##================================================================
cat(">>> Running Example: Collider Mode Sampling\n")
gds_paths <- system.file(
  paste0("extdata/example.chr", 1:3, ".gds"), package = "phenocause"
)

# Goal: Select two parallel sets of causal variants: one "structured" set
# that is highly correlated with PCs, and one "non-structured" set that is not.

# 1. Load metadata containing pre-computed PCs
data(phenocause.metadata)
pca_matrix <- phenocause.metadata[, c("sample.id", paste0("PC", 1:10))]
n_causal <- 50

# 2. Run sampling in collider mode
collider_sites <- sample_causal_sites.collider(
  gds_paths = gds_paths,
  n_causal_sites = n_causal,
  pca_matrix = pca_matrix,
  n_threads = 2
)

# 3. Validate the selection by comparing R^2 summaries between the two sets
cat("\nSummary of R^2 for structured causal sites (high-R^2 set):\n")
summary(collider_sites$annotations$causal_structured$r2)

cat("\nSummary of R^2 for non-structured causal sites (low-R^2 set):\n")
summary(collider_sites$annotations$causal_non_structured$r2)

# 4. Check that differences in R^2 are not due to differences in MAF
cat("\nSummary of MAF for structured causal sites:\n")
summary(collider_sites$annotations$causal_structured$maf)

cat("\nSummary of MAF for non-structured causal sites:\n")
summary(collider_sites$annotations$causal_non_structured$maf)

stopifnot(nrow(collider_sites$genotypes$causal_structured) == n_causal)
stopifnot(nrow(collider_sites$genotypes$causal_non_structured) == n_causal)
cat("\nOK: Collider mode returned the correct number of sites for both sets.\n")
}
}
\references{
Grinde, K.E., Browning, B.L., Reiner, A.P., Thornton, T.A. & Browning, S.R. (2024) Adjusting for principal components can induce collider bias in genome-wide association studies. \emph{PLOS Genetics}, 20(12), e1011242.
}
\seealso{
\code{\link{sample_causal_sites.uniform}}, \code{\link{sample_causal_sites.ldak}}, \code{\link{sample_causal_sites.custom}}
}
